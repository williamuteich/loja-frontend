@if (isLoading()) {
  <section class="py-10">
    <div class="container mx-auto px-4">
      <p class="text-sm text-gray-500">Carregando produtos relacionados...</p>
    </div>
  </section>
} @else if (error()) {
  <section class="py-10">
    <div class="container mx-auto px-4">
      <p class="text-sm text-red-500">{{ error() }}</p>
    </div>
  </section>
} @else if (hasProducts()) {
  <section class="py-12 bg-white overflow-hidden">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4 mb-8">
        <div>
          <h2 class="font-display text-2xl md:text-3xl font-semibold text-slate-900">
            Produtos relacionados
          </h2>
          <p class="text-sm text-slate-500 mt-1">Veja outros produtos que combinam com o que você está vendo.</p>
        </div>
      </div>

      <div class="relative px-1 md:px-0">
        <div class="relative group/container">
          <button
            (click)="scroll('left')"
            class="absolute -left-4 md:-left-4 top-1/2 -translate-y-1/2 z-20 w-10 h-10 md:w-11 md:h-11 rounded-full bg-white border-2 border-rose-100 flex items-center justify-center text-rose-500 shadow-md hover:bg-rose-500 hover:text-white hover:border-rose-500 transition-all duration-300 opacity-0 group-hover/container:opacity-100 cursor-pointer"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
              <path d="m15 18-6-6 6-6"></path>
            </svg>
          </button>
          <button
            (click)="scroll('right')"
            class="absolute -right-4 md:-right-4 top-1/2 -translate-y-1/2 z-20 w-10 h-10 md:w-11 md:h-11 rounded-full bg-white border-2 border-rose-100 flex items-center justify-center text-rose-500 shadow-md hover:bg-rose-500 hover:text-white hover:border-rose-500 transition-all duration-300 opacity-0 group-hover/container:opacity-100 cursor-pointer"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
              <path d="m9 18 6-6-6-6"></path>
            </svg>
          </button>

          <div
            #scrollContainer
            class="flex overflow-x-auto gap-4 md:gap-5 pb-6 no-scrollbar scroll-smooth"
          >
            @for (product of relatedProducts(); track product.id) {
              <div class="w-[190px] sm:w-[200px] md:w-[210px] lg:w-[220px] xl:w-[230px] flex-shrink-0">
                <a
                  [routerLink]="['/produto', product.id]"
                  class="group block bg-white rounded-2xl md:rounded-3xl overflow-hidden border border-slate-200 transition-all duration-500 h-full"
                >
                  <div class="relative w-full aspect-[4/5] max-h-[240px] md:max-h-[260px] overflow-hidden bg-slate-50">
                    @if (product.images && product.images.length > 0) {
                      <img
                        [ngSrc]="backendUrl + '/' + product.images[0].url"
                        [alt]="product.title"
                        fill
                        class="object-cover transition-transform duration-700 group-hover:scale-110"
                        loading="lazy"
                      />
                    } @else {
                      <div class="w-full h-full flex items-center justify-center bg-slate-100 text-slate-400">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8">
                          <rect width="18" height="18" x="3" y="3" rx="2" ry="2"></rect>
                          <circle cx="9" cy="9" r="2"></circle>
                          <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path>
                        </svg>
                      </div>
                    }
                  </div>

                  <div class="p-4 md:p-5 flex flex-col gap-1.5">
                    <h3 class="font-semibold text-slate-800 text-sm md:text-base line-clamp-2 max-h-[2.6rem] overflow-hidden group-hover:text-rose-600 transition-colors">
                      {{ product.title | slice:0:70 }}...
                    </h3>
                    @if (product.description) {
                      <p class="text-xs md:text-sm text-slate-500 line-clamp-2 max-h-[3.2rem] overflow-hidden">
                        {{ product.description | slice:0:120 }}...
                      </p>
                    }

                    <div class="flex items-center gap-2 mt-2">
                      <span class="text-rose-600 font-black text-base md:text-lg">
                        R$ {{ (product.discountPrice || product.price) | number:'1.2-2' }}
                      </span>
                      @if (product.discountPrice && product.discountPrice < product.price) {
                        <span class="text-xs md:text-sm text-slate-400 line-through">
                          R$ {{ product.price | number:'1.2-2' }}
                        </span>
                      }
                    </div>
                  </div>
                </a>
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  </section>
}

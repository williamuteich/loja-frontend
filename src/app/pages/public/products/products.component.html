<main class="flex-1 py-12 bg-gray-50/50 min-h-screen">
    <div class="container mx-auto px-4">
        <div class="mb-10 text-center md:text-left">
            <h1 class="font-display text-4xl md:text-5xl font-semibold text-foreground">Nossos Produtos</h1>
            <p class="text-muted-foreground mt-2 text-lg">Descubra nossa coleção completa de produtos especiais</p>
        </div>

        <div
            class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-8 sticky top-0 z-20 bg-gray-50/95 backdrop-blur-sm p-4 -mx-4 md:static md:bg-transparent md:p-0">
            <div class="flex flex-wrap gap-2 overflow-x-auto pb-2 md:pb-0 no-scrollbar">
                <button (click)="onCategorySelect(null)"
                    class="cursor-pointer px-5 py-2.5 rounded-full text-sm font-semibold transition-all duration-300 shadow-sm whitespace-nowrap border"
                    [class.bg-rose-500]="!selectedCategory()" [class.border-rose-500]="!selectedCategory()"
                    [class.text-white]="!selectedCategory()" [class.bg-white]="selectedCategory()"
                    [class.border-slate-200]="selectedCategory()" [class.text-slate-600]="selectedCategory()"
                    [class.hover:bg-rose-50]="selectedCategory()" [class.hover:border-rose-200]="selectedCategory()">
                    Todos
                </button>

                @for (category of categories(); track category.id) {
                <button (click)="onCategorySelect(category.name)"
                    class="cursor-pointer px-5 py-2.5 rounded-full text-sm font-semibold transition-all duration-300 shadow-sm whitespace-nowrap capitalize border"
                    [class.bg-rose-500]="selectedCategory() === category.name"
                    [class.border-rose-500]="selectedCategory() === category.name"
                    [class.text-white]="selectedCategory() === category.name"
                    [class.bg-white]="selectedCategory() !== category.name"
                    [class.border-slate-200]="selectedCategory() !== category.name"
                    [class.text-slate-600]="selectedCategory() !== category.name"
                    [class.hover:bg-rose-50]="selectedCategory() !== category.name"
                    [class.hover:border-rose-200]="selectedCategory() !== category.name">
                    {{ category.name }}
                </button>
                }
            </div>

            <div
                class="flex items-center gap-2 bg-white p-1 rounded-xl shadow-sm border border-gray-100 self-end md:self-auto">
                <button (click)="toggleViewMode('grid')"
                    class="cursor-pointer inline-flex items-center justify-center h-9 w-9 rounded-lg transition-all duration-300"
                    [class.bg-rose-50]="viewMode() === 'grid'" [class.text-rose-600]="viewMode() === 'grid'"
                    [class.text-slate-400]="viewMode() !== 'grid'" [class.hover:text-slate-600]="viewMode() !== 'grid'">
                    <lucide-icon [img]="icons.Grid3x3" class="w-5 h-5"></lucide-icon>
                </button>

                <button (click)="toggleViewMode('list')"
                    class="cursor-pointer inline-flex items-center justify-center h-9 w-9 rounded-lg transition-all duration-300"
                    [class.bg-rose-50]="viewMode() === 'list'" [class.text-rose-600]="viewMode() === 'list'"
                    [class.text-slate-400]="viewMode() !== 'list'" [class.hover:text-slate-600]="viewMode() !== 'list'">
                    <lucide-icon [img]="icons.LayoutList" class="w-5 h-5"></lucide-icon>
                </button>
            </div>
        </div>

        @if (isLoading()) {
        <div class="grid gap-6 md:gap-8" [class.grid-cols-2]="viewMode() === 'grid'"
            [class.md:grid-cols-3]="viewMode() === 'grid'" [class.lg:grid-cols-4]="viewMode() === 'grid'"
            [class.grid-cols-1]="viewMode() === 'list'">
            @for (i of [1,2,3,4,5,6,7,8]; track i) {
            <div class="bg-white rounded-2xl overflow-hidden border border-gray-100 shadow-sm h-[380px] animate-pulse">
                <div class="bg-gray-200 h-[280px] w-full"></div>
                <div class="p-5 space-y-3">
                    <div class="bg-gray-200 h-6 w-3/4 rounded-md"></div>
                    <div class="bg-gray-200 h-4 w-1/2 rounded-md"></div>
                </div>
            </div>
            }
        </div>
        } @else if (products().length === 0) {
        <div class="text-center py-20 bg-white rounded-3xl border border-dashed border-gray-200">
            <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-primary/5 mb-6 text-primary">
                <lucide-icon [img]="icons.ShoppingBag" class="w-10 h-10"></lucide-icon>
            </div>
            <h3 class="text-xl font-semibold text-foreground mb-2">Nenhum produto encontrado</h3>
            <p class="text-muted-foreground max-w-md mx-auto">
                Tente selecionar outra categoria ou navegue por todas as nossas opções.
            </p>
            <button (click)="onCategorySelect(null)"
                class="cursor-pointer mt-6 px-6 py-2.5 bg-primary text-primary-foreground rounded-full font-medium hover:bg-primary/90 transition-colors shadow-lg shadow-primary/20">
                Ver todos os produtos
            </button>
        </div>
        } @else {
        <div class="grid gap-6 md:gap-8" [class.grid-cols-2]="viewMode() === 'grid'"
            [class.md:grid-cols-3]="viewMode() === 'grid'" [class.lg:grid-cols-4]="viewMode() === 'grid'"
            [class.grid-cols-1]="viewMode() === 'list'">
            @for (product of products(); track product.id) {
            <a [routerLink]="['/produto', product.id]"
                class="group block bg-white rounded-2xl md:rounded-3xl overflow-hidden border border-slate-200 transition-all duration-500 cursor-pointer relative">
                <div class="relative h-[260px] md:h-[280px] bg-slate-100 overflow-hidden">
                    <img [src]="product.imageUrl" [alt]="product.title"
                        class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" />

                    @if (product.discountPrice && product.discountPrice < product.price) { <span
                        class="absolute top-3 left-3 md:top-4 md:left-4 bg-linear-to-r from-rose-500 to-pink-600 text-white text-[10px] md:text-xs font-bold px-3 py-1.5 rounded-full shadow-lg z-10">
                        -{{ ((product.price - product.discountPrice) / product.price * 100) | number:'1.0-0' }}% OFF
                        </span>
                        }
                </div>

                <div class="p-4 md:p-6 pb-16 relative flex flex-col justify-between"
                    [class.flex-1]="viewMode() === 'list'">
                    <div>
                        <span
                            class="text-rose-500 text-[10px] md:text-xs font-bold tracking-widest uppercase mb-1.5 block">
                            {{ product.categories && product.categories.length > 0 ? product.categories[0].category.name
                            : 'Produto' }}
                        </span>

                        <h3
                            class="font-semibold text-slate-800 text-sm md:text-lg group-hover:text-rose-600 transition-colors line-clamp-1 mb-2 md:mb-3">
                            {{ product.title }}
                        </h3>

                        @if (viewMode() === 'list') {
                        <p class="text-slate-500 text-sm line-clamp-2 mb-4 hidden md:block">
                            {{ product.description }}
                        </p>
                        }
                    </div>

                    <div class="flex items-center gap-2 md:gap-3">
                        <span class="text-rose-600 font-black text-lg md:text-2xl">
                            R$ {{ (product.discountPrice || product.price) | number:'1.2-2' }}
                        </span>

                        @if (product.discountPrice && product.discountPrice < product.price) { <span
                            class="text-xs md:text-sm text-slate-400 line-through decoration-rose-300">
                            R$ {{ product.price | number:'1.2-2' }}
                            </span>
                            }
                    </div>

                    <div
                        class="absolute bottom-4 left-4 right-4 translate-y-2 opacity-0 group-hover:translate-y-0 group-hover:opacity-100 transition-all duration-500 hidden md:block">
                        <div
                            class="w-full bg-slate-900 text-white text-center py-2.5 rounded-xl font-semibold text-sm shadow-lg hover:bg-rose-600 transition-colors flex items-center justify-center gap-2">
                            <span>Ver Detalhes</span>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                class="w-4 h-4">
                                <path d="M5 12h14"></path>
                                <path d="m12 5 7 7-7 7"></path>
                            </svg>
                        </div>
                    </div>
                </div>
            </a>
            }
        </div>

        <div class="mt-12">
            <app-pagination [pageIndex]="pageIndex()" [pageSize]="pageSize" [totalItems]="totalItems()"
                [disabled]="isLoading()" (pageChange)="onPageChange($event)"></app-pagination>
        </div>
        }
    </div>
</main>